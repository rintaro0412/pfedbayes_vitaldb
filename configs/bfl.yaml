run:
  out_dir: runs/bfl_batch
  run_name: seed0
  resume: false

seed: 0
device: cuda

data:
  data_dir: federated_data
  train_split: train
  val_split: val
  test_split: test
  # build_dataset metadata (for記録用; 学習コードでは使用しない)
  client_scheme: opname_optype
  merge_strategy: dept_pool
  opname_threshold: 150
  min_client_cases: 150

clients:
  min_examples: 10

backbone:
  checkpoint: runs/fedavg_batch/seed0/checkpoints/model_best.pt
  train_backbone: false

bayes:
  full_bayes: true
  prior_sigma: 0.1
  logvar_min: -12
  logvar_max: 6

train:
  rounds: 100
  local_epochs: 1
  batch_size: 1024
  lr: 0.001
  weight_decay: 0.0001
  num_workers: 8
  mc_train: 3
  mc_eval: 50
  grad_clip: 5.0

beta:
  mode: dataset_scale
  anneal_steps: 1000
  base_beta: 1.0

agg:
  precision_clamp: 1e-6
  beta_mode: normalized

eval:
  threshold:
    method: youden
    recall_target: 0.8
    fixed: 0.5
  calibration:
    temperature_max_iter: 100
  bootstrap:
    n_boot: 1000
    seed: 42
  # Save per-sample test predictions/uncertainty (true => run_dir/test_predictions.npz)
  save_test_pred_npz: true
  test_every_round: true
  per_client_every_round: true
